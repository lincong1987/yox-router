<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>touch</title>
</head>
<body>
    <div id="app"></div>
    <script src="./yox.js"></script>
    <script src="../dist/yox-router.js"></script>
    <script>
        Yox.filter('stringify', function (data) {
          return JSON.stringify(data)
        })

        YoxRouter.register({
          index: {
            template: `
              <div>
                <h1>index</h1>
                <button on-click="register()">
                  register
                </button>
                {{stringify(this)}}
              </div>
            `,
            methods: {
              register: function () {
                this.$router.go({
                  name: 'register',
                  query: { age: 10 }
                })
              }
            }
          },
          register: {
            template: `
              <div>
                <h1>register</h1>
                <button on-click="login()">
                  login
                </button>
                {{stringify(this)}}
              </div>
            `,
            methods: {
              login: function () {
                this.$router.go('/login')
              }
            },
            beforeEnter: function (from, to, next) {
              console.log('component beforeEnter', from, to)
              next()
            },
            afterEnter: function (from, to, next) {
              console.log('component afterEnter', from, to)
              next()
            },
            beforeLeave: function (from, to, next) {
              console.log('component beforeLeave', from, to)
              next()
            },
            afterLeave: function (from, to, next) {
              console.log('component afterLeave', from, to)
              next()
            }
          },
          login: function (resolve) {
            setTimeout(
              function () {
                resolve({
                  template: `
                    <div>
                      <h1>login</h1>
                      <button on-click="index()">
                        index
                      </button>
                      {{stringify(this)}}
                    </div>
                  `,
                  refresh: function (data) {
                    console.log('componentrefresh', data)
                  },
                  methods: {
                    index: function () {
                      this.$router.go({
                        name: 'login',
                        query: {
                          name: 'musicode'
                        }
                      })
                    }
                  }
                })
              },
              1000
            )
          },
          profile: {
            template: `
              <div>
                <h1>profile</h1>
                {{stringify(this)}}
              </div>
            `,
          }
        })

        var router = new YoxRouter()
        router.beforeEnter = function (from, to, next) {
          console.log('router beforeEnter', from, to)
          next()
        }
        router.afterEnter = function (from, to, next) {
          console.log('router afterEnter', from, to)
          next()
        }
        router.beforeLeave = function (from, to, next) {
          console.log('router beforeLeave', from, to)
          next()
        }
        router.afterLeave = function (from, to, next) {
          console.log('router afterLeave', from, to)
          next()
        }
        router.map({
          '/index': {
            component: 'index'
          },
          '/register': {
            name: 'register',
            component: 'register',
            beforeEnter: function (from, to, next) {
              console.log('route beforeEnter', from, to)
              next()
            },
            afterEnter: function (from, to, next) {
              console.log('route afterEnter', from, to)
              next()
            },
            beforeLeave: function (from, to, next) {
              console.log('route beforeLeave', from, to)
              next()
            },
            afterLeave: function (from, to, next) {
              console.log('route afterLeave', from, to)
              next()
            }
          },
          '/login': {
            name: 'login',
            component: 'login'
          },
          '/profile/:id': {
            name: 'profile',
            component: 'profile'
          }
        })

        router.start(document.getElementById('app'))

    </script>
</body>
</html>
