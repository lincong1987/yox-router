!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.YoxRouter=e()}(this,function(){"use strict";function n(n){return n=f.numeric(n)?+n:!f.string(n)||decodeURIComponent(n)}function e(n,e){var t=[n];return f.string(e)?t.push(encodeURIComponent(e)):f.number(e)?t.push(e):e!==!0&&t.pop(),t.join(y)}function t(e){var t=void 0;return p.each(d.parse(e,_,y),function(e){t||(t={});var o=e.key,i=e.value;if(i=n(i),d.endsWith(o,T)){o=o.slice(0,-T.length);var r=t[o]||(t[o]=[]);r.push(i)}else t[o]=i}),t}function o(n){var t=[];return v.each(n,function(n,o){f.array(n)?p.each(n,function(n){n=e(o+T,n),n&&t.push(n)}):(n=e(o,n),n&&t.push(n))}),t.join(_)}function i(e,t){var o=void 0,i=e.split(g),r=t.split(g);return i.length===r.length&&p.each(r,function(e,t){d.startsWith(e,R)&&(o||(o={}),o[e.slice(R.length)]=n(i[t]))}),o}function r(n,e){var t=void 0,o=e.split(g);return v.each(n,function(n,e){var i=e.split(g);if(o.length===i.length&&(p.each(i,function(n,t){if(!d.startsWith(n,R)&&n!==o[t])return e=null,!1}),e))return t=e,!1}),t}function a(n,e){var o=void 0,a=void 0,u=e.indexOf("?");u>=0?(o=e.substring(0,u),a=e.slice(u+1)):o=e;var s={realpath:o},h=r(n,o);return h&&(s.path=h,s.params=i(o,h),s.query=t(a)),s}function u(n,e,t){var i=[],r="";return p.each(n.split(g),function(n){i.push(d.startsWith(n,R)?e[n.slice(R.length)]:n)}),i=i.join(g),t&&(t=o(t),t&&(r="?"+t)),O+i+r}var s=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},h=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),c=void 0,f=void 0,l=void 0,p=void 0,v=void 0,d=void 0,E=void 0,m=void 0,O="#!",R=":",g="/",_="&",y="=",T="[]",H=function(){function n(){s(this,n),this.list=[]}return h(n,[{key:"use",value:function(n,e){f.func(n)&&this.list.push({fn:n,context:e})}},{key:"run",value:function(n,e,t,o){var i=this.list,r=-1,a=function a(u){null==u?(r++,i[r]?i[r].fn.call(i[r].context,n,e,a):t&&t()):o&&o(u)};a()}}]),n}(),C=function(){function n(e){s(this,n);var t=this;t.name2Path={},t.path2Route={},t.handleHashChange=t.onHashChange.bind(t);var o=v,i=o.each,r=o.has,a=n.ROUTE_DEFAULT,u=n.ROUTE_404;return r(e,a)?r(e,u)?void i(e,function(n,e){r(n,"name")&&(t.name2Path[n.name]=e),t.path2Route[e]=n}):void E.error('Route for 404["'+u+'"] is required.'):void E.error('Route for default["'+a+'"] is required.')}return h(n,[{key:"go",value:function(n){if(f.string(n))location.hash=u(n);else if(f.object(n))if(v.has(n,"component"))this.setComponent(n);else if(v.has(n,"name")){var e=this.name2Path[n.name];if(!f.string(e))return void E.error("Name["+n.name+"] of the route is not found.");location.hash=u(e,n.params,n.query)}}},{key:"onHashChange",value:function(){var e=this,t=e.path2Route,o=location,i=o.hash;i=d.startsWith(i,O)?i.slice(O.length):"";var r=a(t,i);v.has(r,"path")||(r.path=i?n.ROUTE_404:n.ROUTE_DEFAULT),this.setComponent(r)}},{key:"setComponent",value:function(e){var t=this,o=t.path2Route,i=t.currentRoute,r=t.currentComponent;r||(r={});var a=r,s=a.options,h=a.instance,f=e.path,l=(e.realpath,e.params),p=e.query,d=e.component,E=e.props,O=void 0;d||(O=o[f],d=O.component);var R=function(n){n===!1?i&&i.path&&(location.hash=u(i.path,i.params,i.query)):t.go(n)},g=function(n,o,r){var a=new H;a.use(s&&s[n],h),a.use(O&&O[n],O),a.use(t&&t[n],t),a.run(e,i,o,r)},_=function(o){s=o,g(n.HOOK_BEFORE_ENTER,function(){(l||p)&&(E=v.extend({},l,p)),h=new m(v.extend({el:t.el,props:E,extensions:{$router:t}},o)),g(n.HOOK_AFTER_ENTER),t.currentRoute=e,t.currentComponent={options:s,instance:h}},R)},y=function(e){g(n.HOOK_BEFORE_LEAVE,function(){h.destroy(),h=null,g(n.HOOK_AFTER_LEAVE),_(e)},R)};r.name=d,c.component(d,function(o){d===r.name&&(h?s===o?g(n.HOOK_REROUTE,function(){y(o)},function(){t.currentRoute=e}):y(o):_(o))})}},{key:"start",value:function(n){this.el=f.string(n)?l.find(n):n,l.on(window,"hashchange",this.handleHashChange),this.handleHashChange()}},{key:"stop",value:function(){this.el=null,l.off(window,"hashchange",this.handleHashChange)}}]),n}();return C.version="0.17.0",C.ROUTE_DEFAULT="",C.ROUTE_404="*",C.HOOK_REROUTE="reroute",C.HOOK_BEFORE_ENTER="beforeEnter",C.HOOK_AFTER_ENTER="afterEnter",C.HOOK_BEFORE_LEAVE="beforeLeave",C.HOOK_AFTER_LEAVE="afterLeave",C.register=function(n,e){c.component(n,e)},C.install=function(n){c=new n({}),m=n,f=n.is,l=n.dom,p=n.array,v=n.object,d=n.string,E=n.logger},"undefined"!=typeof Yox&&Yox.use&&Yox.use(C),C});
