!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.YoxRouter=t()}(this,function(){"use strict";function n(n){var t={};return h.string(n)&&f.each(n.split(E),function(n){var e=n.split("="),o=c(e,2),i=o[0],a=o[1];i&&(a=!h.string(a)||decodeURIComponent(a),i.endsWith("[]")?(t[i]||(t[i]=[])).push(a):t[i]=a)}),t}function t(n){var t=[];return p.each(n,function(n,e){h.array(n)?f.each(n,function(n){t.push(e+"[]="+encodeURIComponent(n))}):t.push(e+"="+encodeURIComponent(n))}),t.join(E)}function e(n,t){var e={},o=n.split(O),i=t.split(O);return o.length===i.length&&f.each(i,function(n,t){n.startsWith(m)&&(e[n.slice(m.length)]=o[t])}),e}function o(n,t){var e=void 0,o=t.split(O);return p.each(n,function(n,t){var i=t.split(O);if(o.length===i.length&&(f.each(i,function(n,e){if(!n.startsWith(m)&&n!==o[e])return t=null,!1}),t))return e=t,!1}),e}function i(t,i){var a=void 0,r=void 0,u=i.indexOf("?");u>=0?(a=i.substring(0,u),r=i.slice(u+1)):a=i;var s=o(t,a);if(s)return{path:s,realpath:a,params:e(a,s),query:n(r)}}function a(n,e,o){var i=[],a="";return f.each(n.split(O),function(n){i.push(n.startsWith(m)?e[n.slice(m.length)]:n)}),i=i.join(O),o&&(o=t(o),o&&(a="?"+o)),d+i+a}function r(n,t){var e=h,o=e.func,i=e.object,a=R[n];o(a)?!function(){var e=a.$pending;e||(e=a.$pending=[],a(function(t){f.each(e,function(n){n(t)}),R[n]=t})),e.push(t)}():i(a)&&t(a)}var u=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function n(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),c=function(){function n(n,t){var e=[],o=!0,i=!1,a=void 0;try{for(var r,u=n[Symbol.iterator]();!(o=(r=u.next()).done)&&(e.push(r.value),!t||e.length!==t);o=!0);}catch(n){i=!0,a=n}finally{try{!o&&u.return&&u.return()}finally{if(i)throw a}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=void 0,f=void 0,p=void 0,l=void 0,v=void 0,d="#!",m=":",O="/",E="&",y=function(){function n(){u(this,n),this.list=[]}return s(n,[{key:"use",value:function(n,t){h.func(n)&&this.list.push({fn:n,context:t})}},{key:"run",value:function(n,t,e,o){var i=this.list,a=-1,r=function r(u){null==u?(a++,i[a]?i[a].fn.call(i[a].context,n,t,r):e&&e()):o&&o(u)};r()}}]),n}(),g=function(){function n(t){u(this,n);var e=this;e.name2Path={},e.path2Route={},e.handleHashChange=e.onHashChange.bind(e),t&&!function(){var n=p,o=n.each,i=n.has;o(t,function(n,t){i(n,"name")&&(e.name2Path[n.name]=t),e.path2Route[t]=n})}()}return s(n,[{key:"go",value:function(n){h.string(n)?location.hash=a(n):h.object(n)&&(p.has(n,"component")?this.setComponent(n.component,n.props):p.has(n,"name")&&(location.hash=a(this.name2Path[n.name],n.params,n.query)))}},{key:"onHashChange",value:function(){var t=this,e=t.path2Route,o=location,a=o.hash;a=a.startsWith(d)?a.slice(d.length):"";var r=i(e,a);if(r){var u=r.path,s=r.params,c=r.query;this.setComponent(u,s,c)}else{var h=a?n.HOOK_NOT_FOUND:n.HOOK_INDEX;t[h]&&t[h]()}}},{key:"setComponent",value:function(){var t=this,e=t.path2Route,o=t.componentConfig,i=t.componentInstance,u=arguments,s=void 0,c=void 0,h=void 0,f=void 0,l=void 0,d=void 0;u[2]?(h=u[0],f=u[1],l=u[2],d=e[h],s=d.component):(s=u[0],c=u[1]);var m={component:t.component,props:t.props,path:t.path,params:t.params,query:t.query},O={component:s,props:c,path:h,params:f,query:l},E=function(n){n===!1?m.path&&(location.hash=a(m.path,m.params,m.query)):t.go(n)},g=function(n,e,a){var r=new y;r.use(o&&o[n],i),r.use(d&&d[n],d),r.use(t&&t[n],t),r.run(O,m,e,a)},R=function(e){o=e,g(n.HOOK_BEFORE_ENTER,function(){(f||l)&&(c=p.extend({},f,l)),i=new v(p.extend({el:t.el,props:c,extensions:{$router:t}},e)),g(n.HOOK_AFTER_ENTER),p.extend(t,O),t.componentConfig=o,t.componentInstance=i},E)},_=function(t){g(n.HOOK_BEFORE_LEAVE,function(){i.dispose(),i=null,g(n.HOOK_AFTER_LEAVE),R(t)},E)};t.componentName=s,r(s,function(e){s===t.componentName&&(i?o===e?g(n.HOOK_REROUTE,function(){_(e)},function(){p.extend(t,O)}):_(e):R(e))})}},{key:"start",value:function(n){h.string(n)&&(n=l.find(n)),this.el=n,this.handleHashChange(),l.on(window,"hashchange",this.handleHashChange)}},{key:"stop",value:function(){this.el=null,l.off(window,"hashchange",this.handleHashChange)}}]),n}(),R={};return g.version="0.2.4",g.HOOK_INDEX="index",g.HOOK_NOT_FOUND="notFound",g.HOOK_REROUTE="reroute",g.HOOK_BEFORE_ENTER="beforeEnter",g.HOOK_AFTER_ENTER="afterEnter",g.HOOK_BEFORE_LEAVE="beforeLeave",g.HOOK_AFTER_LEAVE="afterLeave",g.register=function(n,t){h.object(n)?p.extend(R,n):R[n]=t},g.install=function(n){v=n;var t=v,e=t.utils;h=e.is,f=e.array,p=e.object,l=e.native},"undefined"!=typeof Yox&&Yox.use&&Yox.use(g),g});
