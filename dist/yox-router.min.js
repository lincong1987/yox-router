!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.YoxRouter=e()}(this,function(){"use strict";function n(n){var e={};return p.each(v.parse(n,g,y),function(n){var t=n.key,o=n.value;if(o=h.numeric(o)?+o:!h.string(o)||decodeURIComponent(o),v.endsWith(t,R)){t=t.slice(0,-R.length);var i=e[t]||(e[t]=[]);i.push(o)}else e[t]=o}),e}function e(n,e){var t=[n];return h.string(e)?t.push(encodeURIComponent(e)):h.number(e)?t.push(e):e!==!0&&t.pop(),t.join(y)}function t(n){var t=[];return l.each(n,function(n,o){h.array(n)?p.each(n,function(n){n=e(o+R,n),n&&t.push(n)}):(n=e(o,n),n&&t.push(n))}),t.join(g)}function o(n,e){var t={},o=n.split(O),i=e.split(O);return o.length===i.length&&p.each(i,function(n,e){v.startsWith(n,E)&&(t[n.slice(E.length)]=o[e])}),t}function i(n,e){var t=void 0,o=e.split(O);return l.each(n,function(n,e){var i=e.split(O);if(o.length===i.length&&(p.each(i,function(n,t){if(!v.startsWith(n,E)&&n!==o[t])return e=null,!1}),e))return t=e,!1}),t}function a(e,t){var a=void 0,r=void 0,u=t.indexOf("?");u>=0?(a=t.substring(0,u),r=t.slice(u+1)):a=t;var s=i(e,a);if(s)return{path:s,realpath:a,params:o(a,s),query:n(r)}}function r(n,e,o){var i=[],a="";return p.each(n.split(O),function(n){i.push(v.startsWith(n,E)?e[n.slice(E.length)]:n)}),i=i.join(O),o&&(o=t(o),o&&(a="?"+o)),m+i+a}var u=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),c=void 0,h=void 0,f=void 0,p=void 0,l=void 0,v=void 0,d=void 0,m="#!",E=":",O="/",g="&",y="=",R="[]",_=function(){function n(){u(this,n),this.list=[]}return s(n,[{key:"use",value:function(n,e){h.func(n)&&this.list.push({fn:n,context:e})}},{key:"run",value:function(n,e,t,o){var i=this.list,a=-1,r=function r(u){null==u?(a++,i[a]?i[a].fn.call(i[a].context,n,e,r):t&&t()):o&&o(u)};r()}}]),n}(),H=function(){function n(e){u(this,n);var t=this;t.name2Path={},t.path2Route={},t.handleHashChange=t.onHashChange.bind(t),e&&!function(){var n=l,o=n.each,i=n.has;o(e,function(n,e){i(n,"name")&&(t.name2Path[n.name]=e),t.path2Route[e]=n})}()}return s(n,[{key:"go",value:function(n){h.string(n)?location.hash=r(n):h.object(n)&&(l.has(n,"component")?this.setComponent(n.component,n.props):l.has(n,"name")&&(location.hash=r(this.name2Path[n.name],n.params,n.query)))}},{key:"onHashChange",value:function(){var n=this,e=n.path2Route,t=location,o=t.hash;o=v.startsWith(o,m)?o.slice(m.length):"";var i=a(e,o);if(i){var r=i.path,u=i.params,s=i.query;this.setComponent(r,u,s)}else{var c=o?"*":"",h={};this.setComponent(c,h,h)}}},{key:"setComponent",value:function(){var e=this,t=e.path2Route,o=e.currentRoute,i=e.currentComponent;i||(i={});var a=i,u=a.options,s=a.instance,f=arguments,p=void 0,v=void 0,m=void 0,E=void 0,O=void 0,g=void 0;f[2]?(E=f[0],O=f[1],g=f[2],p=t[E],v=p.component):(v=f[0],m=f[1]);var y={component:v,props:m,path:E,params:O,query:g},R=function(n){n===!1?o&&o.path&&(location.hash=r(o.path,o.params,o.query)):e.go(n)},H=function(n,t,i){var a=new _;a.use(u&&u[n],s),a.use(p&&p[n],p),a.use(e&&e[n],e),a.run(y,o,t,i)},C=function(t){u=t,H(n.HOOK_BEFORE_ENTER,function(){(O||g)&&(m=l.extend({},O,g)),m&&h.object(t.propTypes)&&(m=d.validate(m,t.propTypes)),s=new d(l.extend({el:e.el,props:m,extensions:{$router:e}},t)),H(n.HOOK_AFTER_ENTER),e.currentRoute=y,e.currentComponent={options:u,instance:s}},R)},b=function(e){H(n.HOOK_BEFORE_LEAVE,function(){s.destroy(),s=null,H(n.HOOK_AFTER_LEAVE),C(e)},R)};i.name=v,c.component(v,function(t){v===i.name&&(s?u===t?H(n.HOOK_REROUTE,function(){b(t)},function(){e.currentRoute=y}):b(t):C(t))})}},{key:"start",value:function(n){this.el=h.string(n)?f.find(n):n,this.handleHashChange(),f.on(window,"hashchange",this.handleHashChange)}},{key:"stop",value:function(){this.el=null,f.off(window,"hashchange",this.handleHashChange)}}]),n}();return H.version="0.12.0",H.HOOK_REROUTE="reroute",H.HOOK_BEFORE_ENTER="beforeEnter",H.HOOK_AFTER_ENTER="afterEnter",H.HOOK_BEFORE_LEAVE="beforeLeave",H.HOOK_AFTER_LEAVE="afterLeave",H.register=function(n,e){c.component(n,e)},H.install=function(n){c=new n({}),d=n,h=n.is,f=n.dom,p=n.array,l=n.object,v=n.string},"undefined"!=typeof Yox&&Yox.use&&Yox.use(H),H});
