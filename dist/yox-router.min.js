!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.YoxRouter=t()}(this,function(){"use strict";function n(n){var t={};return h.string(n)&&f.each(n.split(y),function(n){var e=n.split("="),o=s(e,2),i=o[0],r=o[1];if(i)if(r=!h.string(r)||decodeURIComponent(r),i.endsWith(O)){i=i.slice(0,-O.length);var a=t[i]||(t[i]=[]);a.push(r)}else t[i]=r}),t}function t(n){var t=[];return l.each(n,function(n,e){h.array(n)?f.each(n,function(n){t.push(""+e+O+"="+encodeURIComponent(n))}):t.push(e+"="+encodeURIComponent(n))}),t.join(y)}function e(n,t){var e={},o=n.split(E),i=t.split(E);return o.length===i.length&&f.each(i,function(n,t){n.startsWith(m)&&(e[n.slice(m.length)]=o[t])}),e}function o(n,t){var e=void 0,o=t.split(E);return l.each(n,function(n,t){var i=t.split(E);if(o.length===i.length&&(f.each(i,function(n,e){if(!n.startsWith(m)&&n!==o[e])return t=null,!1}),t))return e=t,!1}),e}function i(t,i){var r=void 0,a=void 0,u=i.indexOf("?");u>=0?(r=i.substring(0,u),a=i.slice(u+1)):r=i;var s=o(t,r);if(s)return{path:s,realpath:r,params:e(r,s),query:n(a)}}function r(n,e,o){var i=[],r="";return f.each(n.split(E),function(n){i.push(n.startsWith(m)?e[n.slice(m.length)]:n)}),i=i.join(E),o&&(o=t(o),o&&(r="?"+o)),d+i+r}var a=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function n(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),s=function(){function n(n,t){var e=[],o=!0,i=!1,r=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);o=!0);}catch(n){i=!0,r=n}finally{try{!o&&u.return&&u.return()}finally{if(i)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=void 0,h=void 0,f=void 0,l=void 0,p=void 0,v=void 0,d="#!",m=":",E="/",y="&",O="[]",g=function(){function n(){a(this,n),this.list=[]}return u(n,[{key:"use",value:function(n,t){h.func(n)&&this.list.push({fn:n,context:t})}},{key:"run",value:function(n,t,e,o){var i=this.list,r=-1,a=function a(u){null==u?(r++,i[r]?i[r].fn.call(i[r].context,n,t,a):e&&e()):o&&o(u)};a()}}]),n}(),R=function(){function n(t){a(this,n);var e=this;e.name2Path={},e.path2Route={},e.handleHashChange=e.onHashChange.bind(e),t&&!function(){var n=l,o=n.each,i=n.has;o(t,function(n,t){i(n,"name")&&(e.name2Path[n.name]=t),e.path2Route[t]=n})}()}return u(n,[{key:"go",value:function(n){h.string(n)?location.hash=r(n):h.object(n)&&(l.has(n,"component")?this.setComponent(n.component,n.props):l.has(n,"name")&&(location.hash=r(this.name2Path[n.name],n.params,n.query)))}},{key:"onHashChange",value:function(){var n=this,t=n.path2Route,e=location,o=e.hash;o=o.startsWith(d)?o.slice(d.length):"";var r=i(t,o);if(r){var a=r.path,u=r.params,s=r.query;this.setComponent(a,u,s)}else{var c=o?"*":"",h={};this.setComponent(c,h,h)}}},{key:"setComponent",value:function(){var t=this,e=t.path2Route,o=t.currentRoute,i=t.currentComponent;i||(i={});var a=i,u=a.options,s=a.instance,h=arguments,f=void 0,p=void 0,d=void 0,m=void 0,E=void 0,y=void 0;h[2]?(m=h[0],E=h[1],y=h[2],f=e[m],p=f.component):(p=h[0],d=h[1]);var O={component:p,props:d,path:m,params:E,query:y},R=function(n){n===!1?o&&o.path&&(location.hash=r(o.path,o.params,o.query)):t.go(n)},_=function(n,e,i){var r=new g;r.use(u&&u[n],s),r.use(f&&f[n],f),r.use(t&&t[n],t),r.run(O,o,e,i)},b=function(e){u=e,_(n.HOOK_BEFORE_ENTER,function(){(E||y)&&(d=l.extend({},E,y)),d&&l.has(e,"propTypes")&&v.validate(d,e.propTypes),s=new v(l.extend({el:t.el,props:d,extensions:{$router:t}},e)),_(n.HOOK_AFTER_ENTER),t.currentRoute=O,t.currentComponent={options:u,instance:s}},R)},C=function(t){_(n.HOOK_BEFORE_LEAVE,function(){s.destroy(),s=null,_(n.HOOK_AFTER_LEAVE),b(t)},R)};i.name=p,c.component(p,function(e){p===i.name&&(s?u===e?_(n.HOOK_REROUTE,function(){C(e)},function(){t.currentRoute=O}):C(e):b(e))})}},{key:"start",value:function(n){h.string(n)&&(n=p.find(n)),this.el=n,this.handleHashChange(),p.on(window,"hashchange",this.handleHashChange)}},{key:"stop",value:function(){this.el=null,p.off(window,"hashchange",this.handleHashChange)}}]),n}();return R.version="0.8.0",R.HOOK_REROUTE="reroute",R.HOOK_BEFORE_ENTER="beforeEnter",R.HOOK_AFTER_ENTER="afterEnter",R.HOOK_BEFORE_LEAVE="beforeLeave",R.HOOK_AFTER_LEAVE="afterLeave",R.register=function(n,t){c.component(n,t)},R.install=function(n){c=new n({}),v=n;var t=n.utils;h=t.is,f=t.array,l=t.object,p=t.native},"undefined"!=typeof Yox&&Yox.use&&Yox.use(R),R});
