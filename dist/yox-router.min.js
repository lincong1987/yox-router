!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.YoxRouter=e()}(this,function(){"use strict";function n(n){var e={};return l.each(v.parse(n,R,g),function(n){var t=n.key,o=n.value;if(o=c.numeric(o)?+o:!c.string(o)||decodeURIComponent(o),v.endsWith(t,y)){t=t.slice(0,-y.length);var i=e[t]||(e[t]=[]);i.push(o)}else e[t]=o}),e}function e(n,e){var t=[n];return c.string(e)?t.push(encodeURIComponent(e)):c.number(e)?t.push(e):e!==!0&&t.pop(),t.join(g)}function t(n){var t=[];return p.each(n,function(n,o){c.array(n)?l.each(n,function(n){n=e(o+y,n),n&&t.push(n)}):(n=e(o,n),n&&t.push(n))}),t.join(R)}function o(n,e){var t={},o=n.split(O),i=e.split(O);return o.length===i.length&&l.each(i,function(n,e){v.startsWith(n,m)&&(t[n.slice(m.length)]=o[e])}),t}function i(n,e){var t=void 0,o=e.split(O);return p.each(n,function(n,e){var i=e.split(O);if(o.length===i.length&&(l.each(i,function(n,t){if(!v.startsWith(n,m)&&n!==o[t])return e=null,!1}),e))return t=e,!1}),t}function r(e,t){var r=void 0,a=void 0,u=t.indexOf("?");u>=0?(r=t.substring(0,u),a=t.slice(u+1)):r=t;var s={realpath:r},h=i(e,r);return h&&(s.path=h,s.params=o(r,h),s.query=n(a)),s}function a(n,e,o){var i=[],r="";return l.each(n.split(O),function(n){i.push(v.startsWith(n,m)?e[n.slice(m.length)]:n)}),i=i.join(O),o&&(o=t(o),o&&(r="?"+o)),E+i+r}var u=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),h=void 0,c=void 0,f=void 0,l=void 0,p=void 0,v=void 0,d=void 0,E="#!",m=":",O="/",R="&",g="=",y="[]",_=function(){function n(){u(this,n),this.list=[]}return s(n,[{key:"use",value:function(n,e){c.func(n)&&this.list.push({fn:n,context:e})}},{key:"run",value:function(n,e,t,o){var i=this.list,r=-1,a=function a(u){null==u?(r++,i[r]?i[r].fn.call(i[r].context,n,e,a):t&&t()):o&&o(u)};a()}}]),n}(),T=function(){function n(e){u(this,n);var t=this;t.name2Path={},t.path2Route={},t.handleHashChange=t.onHashChange.bind(t);var o=p,i=o.each,r=o.has,a=n.ROUTE_DEFAULT,s=n.ROUTE_404;return r(e,a)?r(e,s)?void i(e,function(n,e){r(n,"name")&&(t.name2Path[n.name]=e),t.path2Route[e]=n}):void console.error('Route for 404["'+s+'"] is required.'):void console.error('Route for default["'+a+'"] is required.')}return s(n,[{key:"go",value:function(n){if(c.string(n))location.hash=a(n);else if(c.object(n))if(p.has(n,"component"))this.setComponent(n);else if(p.has(n,"name")){var e=this.name2Path[n.name];if(!c.string(e))return void console.error("Name["+n.name+"] of the route is not found.");location.hash=a(e,n.params,n.query)}}},{key:"onHashChange",value:function(){var e=this,t=e.path2Route,o=location,i=o.hash;i=v.startsWith(i,E)?i.slice(E.length):"";var a=r(t,i);p.has(a,"path")||(a.path=i?n.ROUTE_404:n.ROUTE_DEFAULT),this.setComponent(a)}},{key:"setComponent",value:function(e){var t=this,o=t.path2Route,i=t.currentRoute,r=t.currentComponent;r||(r={});var u=r,s=u.options,f=u.instance,l=e.path,v=e.realpath,E=e.params,m=e.query,O=e.component,R=e.props,g=void 0;O||(g=o[l],O=g.component);var y={path:l,realpath:v,params:E,query:m,component:O,props:R},T=function(n){n===!1?i&&i.path&&(location.hash=a(i.path,i.params,i.query)):t.go(n)},H=function(n,e,o){var r=new _;r.use(s&&s[n],f),r.use(g&&g[n],g),r.use(t&&t[n],t),r.run(y,i,e,o)},b=function(e){s=e,H(n.HOOK_BEFORE_ENTER,function(){(E||m)&&(R=p.extend({},E,m)),R&&c.object(e.propTypes)&&(R=d.validate(R,e.propTypes)),f=new d(p.extend({el:t.el,props:R,extensions:{$router:t}},e)),H(n.HOOK_AFTER_ENTER),t.currentRoute=y,t.currentComponent={options:s,instance:f}},T)},C=function(e){H(n.HOOK_BEFORE_LEAVE,function(){f.destroy(),f=null,H(n.HOOK_AFTER_LEAVE),b(e)},T)};r.name=O,h.component(O,function(e){O===r.name&&(f?s===e?H(n.HOOK_REROUTE,function(){C(e)},function(){t.currentRoute=y}):C(e):b(e))})}},{key:"start",value:function(n){this.el=c.string(n)?f.find(n):n,f.on(window,"hashchange",this.handleHashChange),this.handleHashChange()}},{key:"stop",value:function(){this.el=null,f.off(window,"hashchange",this.handleHashChange)}}]),n}();return T.version="0.15.0",T.ROUTE_DEFAULT="",T.ROUTE_404="*",T.HOOK_REROUTE="reroute",T.HOOK_BEFORE_ENTER="beforeEnter",T.HOOK_AFTER_ENTER="afterEnter",T.HOOK_BEFORE_LEAVE="beforeLeave",T.HOOK_AFTER_LEAVE="afterLeave",T.register=function(n,e){h.component(n,e)},T.install=function(n){h=new n({}),d=n,c=n.is,f=n.dom,l=n.array,p=n.object,v=n.string},"undefined"!=typeof Yox&&Yox.use&&Yox.use(T),T});
