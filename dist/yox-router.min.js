!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.YoxRouter=t()}(this,function(){"use strict";function n(n){var t={};return h.string(n)&&l.each(n.split(O),function(n){var e=n.split("="),o=s(e,2),r=o[0],i=o[1];r&&(i=h.string(i)?decodeURIComponent(i):f.TRUE,r.endsWith("[]")?(t[r]||(t[r]=[])).push(i):t[r]=i)}),t}function t(n){var t=[];return p.each(n,function(n,e){h.array(n)?l.each(n,function(n){t.push(e+"[]="+encodeURIComponent(n))}):t.push(e+"="+encodeURIComponent(n))}),t.join(O)}function e(n,t){var e={},o=n.split(E),r=t.split(E);return o.length===r.length&&l.each(r,function(n,t){n.startsWith(y)&&(e[n.slice(y.length)]=o[t])}),e}function o(n,t){var e=void 0,o=t.split(E);return p.each(n,function(n,t){var r=t.split(E);if(o.length===r.length&&(l.each(r,function(n,e){if(!n.startsWith(y)&&n!==o[e])return t=null,!1}),t))return e=t,!1}),e}function r(t,r){var i=void 0,a=void 0,u=r.indexOf("?");u>=0?(i=r.substring(0,u),a=r.slice(u+1)):i=r;var c=o(t,i);if(c)return{path:c,realpath:i,params:e(i,c),query:n(a)}}function i(n,e,o){var r=[],i="";return l.each(n.split(E),function(n){r.push(n.startsWith(y)?e[n.slice(y.length)]:n)}),r=r.join(E),o&&(o=t(o),o&&(i="?"+o)),m+r+i}function a(n,t){var e=h,o=e.func,r=e.object,i=b[n];o(i)?!function(){var e=i.$pending;e||(e=i.$pending=[],i(function(t){l.each(e,function(n){n(t)}),b[n]=t})),e.push(t)}():r(i)&&t(i)}var u=(function(){function n(n){this.value=n}function t(t){function e(n,t){return new Promise(function(e,r){var u={key:n,arg:t,resolve:e,reject:r,next:null};a?a=a.next=u:(i=a=u,o(n,t))})}function o(e,i){try{var a=t[e](i),u=a.value;u instanceof n?Promise.resolve(u.value).then(function(n){o("next",n)},function(n){o("throw",n)}):r(a.done?"return":"normal",a.value)}catch(n){r("throw",n)}}function r(n,t){switch(n){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?o(i.key,i.arg):a=null}var i,a;this._invoke=e,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(n){return this._invoke("next",n)},t.prototype.throw=function(n){return this._invoke("throw",n)},t.prototype.return=function(n){return this._invoke("return",n)},{wrap:function(n){return function(){return new t(n.apply(this,arguments))}},await:function(t){return new n(t)}}}(),function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}),c=function(){function n(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),s=function(){function n(n,t){var e=[],o=!0,r=!1,i=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);o=!0);}catch(n){r=!0,i=n}finally{try{!o&&u.return&&u.return()}finally{if(r)throw i}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=void 0,f=void 0,l=void 0,p=void 0,v=void 0,d=void 0,m="#!",y=":",E="/",O="&",g="hashchange",_=function(){function n(){u(this,n),this.list=[]}return c(n,[{key:"use",value:function(n){h.func(n)&&this.list.push(n)}},{key:"run",value:function(n,t,e,o,r){var i=this.list,a=-1,u=function u(c){c==f.NULL?(a++,i[a]?i[a].call(n,t,e,u):o&&o()):r&&r(c)};u()}}]),n}(),R=function(){function n(){u(this,n),this.name2Path={},this.path2Route={}}return c(n,[{key:"map",value:function(n){var t=this.name2Path,e=this.path2Route,o=p,r=o.each,i=o.has;r(n,function(n,o){i(n,"name")&&(t[n.name]=o),e[o]=n})}},{key:"go",value:function(n){h.string(n)?location.hash=i(n):h.object(n)&&(p.has(n,"component")?this.setComponent(n.component,n.props):p.has(n,"name")&&(location.hash=i(this.name2Path[n.name],n.params,n.query)))}},{key:"handleHashChange",value:function(){var t=this,e=t.path2Route,o=location,i=o.hash;i=i.startsWith(m)?i.slice(m.length):"";var a=r(e,i);if(a){var u=a.path,c=a.params,s=a.query;this.setComponent(u,c,s)}else{var h=i?n.HOOK_NOT_FOUND:n.HOOK_INDEX;t[h]&&t[h]()}}},{key:"setComponent",value:function(){var t=this,e=t.path2Route,o=t.componentConfig,r=t.componentInstance,u=arguments,c=void 0,s=void 0,h=void 0,l=void 0,v=void 0,m=void 0;u[2]?(h=u[0],l=u[1],v=u[2],m=e[h],c=m.component):(c=u[0],s=u[1]);var y={component:t.component,props:t.props,path:t.path,params:t.params,query:t.query},E={component:c,props:s,path:h,params:l,query:v},O=function(n){n===f.FALSE?y.path&&(location.hash=i(y.path,y.params,y.query)):t.go(n)},g=function(n,e,i){var a=new _;a.use(o&&o[n]),a.use(m&&m[n]),a.use(t&&t[n]),a.run(r,E,y,e,i)},R=function(e){o=e,g(n.HOOK_BEFORE_ENTER,function(){(l||v)&&(s=p.extend({},l,v)),r=new d(p.extend({el:t.el,props:s,extensions:{$router:t}},e)),g(n.HOOK_AFTER_ENTER),p.extend(t,E),t.componentConfig=o,t.componentInstance=r},O)},b=function(t){g(n.HOOK_BEFORE_LEAVE,function(){r.dispose(),r=f.NULL,g(n.HOOK_AFTER_LEAVE),R(t)},O)};t.componentName=c,a(c,function(e){c===t.componentName&&(r?o===e?g(n.HOOK_REFRESH,function(){b(e)},function(){p.extend(t,E)}):b(e):R(e))})}},{key:"start",value:function(n){h.string(n)&&(n=v.find(n)),this.el=n,this.handleHashChange(),v.on(f.win,g,this.handleHashChange,this)}},{key:"stop",value:function(){this.el=f.NULL,v.off(f.win,g,this.handleHashChange)}}]),n}(),b={};return R.HOOK_INDEX="index",R.HOOK_NOT_FOUND="notFound",R.HOOK_REFRESH="refresh",R.HOOK_BEFORE_ENTER="beforeEnter",R.HOOK_AFTER_ENTER="afterEnter",R.HOOK_BEFORE_LEAVE="beforeLeave",R.HOOK_AFTER_LEAVE="afterLeave",R.register=function(n,t){h.object(n)?p.extend(b,n):b[n]=t},R.install=function(n){d=n;var t=d,e=t.utils;h=e.is,f=e.env,l=e.array,p=e.object,v=e.native},"undefined"!=typeof Yox&&Yox.use&&Yox.use(R),R});
