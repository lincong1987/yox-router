!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.YoxRouter=t()}(this,function(){"use strict";function n(n){var t={};return h.string(n)&&f.each(n.split(m),function(n){var e=n.split("="),o=c(e,2),i=o[0],r=o[1];i&&(r=!h.string(r)||decodeURIComponent(r),i.endsWith("[]")?(t[i]||(t[i]=[])).push(r):t[i]=r)}),t}function t(n){var t=[];return l.each(n,function(n,e){h.array(n)?f.each(n,function(n){t.push(e+"[]="+encodeURIComponent(n))}):t.push(e+"="+encodeURIComponent(n))}),t.join(m)}function e(n,t){var e={},o=n.split(E),i=t.split(E);return o.length===i.length&&f.each(i,function(n,t){n.startsWith(O)&&(e[n.slice(O.length)]=o[t])}),e}function o(n,t){var e=void 0,o=t.split(E);return l.each(n,function(n,t){var i=t.split(E);if(o.length===i.length&&(f.each(i,function(n,e){if(!n.startsWith(O)&&n!==o[e])return t=null,!1}),t))return e=t,!1}),e}function i(t,i){var r=void 0,a=void 0,u=i.indexOf("?");u>=0?(r=i.substring(0,u),a=i.slice(u+1)):r=i;var s=o(t,r);if(s)return{path:s,realpath:r,params:e(r,s),query:n(a)}}function r(n,e,o){var i=[],r="";return f.each(n.split(E),function(n){i.push(n.startsWith(O)?e[n.slice(O.length)]:n)}),i=i.join(E),o&&(o=t(o),o&&(r="?"+o)),d+i+r}function a(n,t){var e=h,o=e.func,i=e.object,r=R[n];o(r)?!function(){var e=r.$pending;e||(e=r.$pending=[],r(function(t){f.each(e,function(n){n(t)}),R[n]=t})),e.push(t)}():i(r)&&t(r)}var u=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function n(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),c=function(){function n(n,t){var e=[],o=!0,i=!1,r=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);o=!0);}catch(n){i=!0,r=n}finally{try{!o&&u.return&&u.return()}finally{if(i)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=void 0,f=void 0,l=void 0,p=void 0,v=void 0,d="#!",O=":",E="/",m="&",y=function(){function n(){u(this,n),this.list=[]}return s(n,[{key:"use",value:function(n,t){h.func(n)&&this.list.push({fn:n,context:t})}},{key:"run",value:function(n,t,e,o){var i=this.list,r=-1,a=function a(u){null==u?(r++,i[r]?i[r].fn.call(i[r].context,n,t,a):e&&e()):o&&o(u)};a()}}]),n}(),g=function(){function n(t){u(this,n);var e=this;e.name2Path={},e.path2Route={},e.handleHashChange=e.onHashChange.bind(e),t&&!function(){var n=l,o=n.each,i=n.has;o(t,function(n,t){i(n,"name")&&(e.name2Path[n.name]=t),e.path2Route[t]=n})}()}return s(n,[{key:"go",value:function(n){h.string(n)?location.hash=r(n):h.object(n)&&(l.has(n,"component")?this.setComponent(n.component,n.props):l.has(n,"name")&&(location.hash=r(this.name2Path[n.name],n.params,n.query)))}},{key:"onHashChange",value:function(){var t=this,e=t.path2Route,o=location,r=o.hash;r=r.startsWith(d)?r.slice(d.length):"";var a=i(e,r);if(a){var u=a.path,s=a.params,c=a.query;this.setComponent(u,s,c)}else{var h=r?n.HOOK_NOT_FOUND:n.HOOK_INDEX;t[h]&&t[h]()}}},{key:"setComponent",value:function(){var t=this,e=t.path2Route,o=t.currentRoute,i=t.currentComponent;i||(i={});var u=i,s=u.options,c=u.instance,h=arguments,f=void 0,p=void 0,d=void 0,O=void 0,E=void 0,m=void 0;h[2]?(O=h[0],E=h[1],m=h[2],f=e[O],p=f.component):(p=h[0],d=h[1]);var g={component:p,props:d,path:O,params:E,query:m},R=function(n){n===!1?o&&o.path&&(location.hash=r(o.path,o.params,o.query)):t.go(n)},_=function(n,e,i){var r=new y;r.use(s&&s[n],c),r.use(f&&f[n],f),r.use(t&&t[n],t),r.run(g,o,e,i)},H=function(e){s=e,_(n.HOOK_BEFORE_ENTER,function(){(E||m)&&(d=l.extend({},E,m)),c=new v(l.extend({el:t.el,props:d,extensions:{$router:t}},e)),_(n.HOOK_AFTER_ENTER),t.currentRoute=g,t.currentComponent={options:s,instance:c}},R)},b=function(t){_(n.HOOK_BEFORE_LEAVE,function(){c.dispose(),c=null,_(n.HOOK_AFTER_LEAVE),H(t)},R)};i.name=p,a(p,function(e){p===i.name&&(c?s===e?_(n.HOOK_REROUTE,function(){b(e)},function(){t.currentRoute=g}):b(e):H(e))})}},{key:"start",value:function(n){h.string(n)&&(n=p.find(n)),this.el=n,this.handleHashChange(),p.on(window,"hashchange",this.handleHashChange)}},{key:"stop",value:function(){this.el=null,p.off(window,"hashchange",this.handleHashChange)}}]),n}(),R={};return g.version="0.2.5",g.HOOK_INDEX="index",g.HOOK_NOT_FOUND="notFound",g.HOOK_REROUTE="reroute",g.HOOK_BEFORE_ENTER="beforeEnter",g.HOOK_AFTER_ENTER="afterEnter",g.HOOK_BEFORE_LEAVE="beforeLeave",g.HOOK_AFTER_LEAVE="afterLeave",g.register=function(n,t){h.object(n)?l.extend(R,n):R[n]=t},g.install=function(n){v=n;var t=v,e=t.utils;h=e.is,f=e.array,l=e.object,p=e.native},"undefined"!=typeof Yox&&Yox.use&&Yox.use(g),g});
