!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.YoxRouter=e()}(this,function(){"use strict";function n(n){return n=f.numeric(n)?+n:!f.string(n)||decodeURIComponent(n)}function e(e){var t=void 0;return p.each(d.parse(e,g,y),function(e){t||(t={});var o=e.key,i=e.value;if(i=n(i),d.endsWith(o,_)){o=o.slice(0,-_.length);var r=t[o]||(t[o]=[]);r.push(i)}else t[o]=i}),t}function t(n,e){var t=[n];return f.string(e)?t.push(encodeURIComponent(e)):f.number(e)?t.push(e):e!==!0&&t.pop(),t.join(y)}function o(n){var e=[];return v.each(n,function(n,o){f.array(n)?p.each(n,function(n){n=t(o+_,n),n&&e.push(n)}):(n=t(o,n),n&&e.push(n))}),e.join(g)}function i(e,t){var o=void 0,i=e.split(R),r=t.split(R);return i.length===r.length&&p.each(r,function(e,t){d.startsWith(e,O)&&(o||(o={}),o[e.slice(O.length)]=n(i[t]))}),o}function r(n,e){var t=void 0,o=e.split(R);return v.each(n,function(n,e){var i=e.split(R);if(o.length===i.length&&(p.each(i,function(n,t){if(!d.startsWith(n,O)&&n!==o[t])return e=null,!1}),e))return t=e,!1}),t}function a(n,t){var o=void 0,a=void 0,u=t.indexOf("?");u>=0?(o=t.substring(0,u),a=t.slice(u+1)):o=t;var s={realpath:o},c=r(n,o);return c&&(s.path=c,s.params=i(o,c),s.query=e(a)),s}function u(n,e,t){var i=[],r="";return p.each(n.split(R),function(n){i.push(d.startsWith(n,O)?e[n.slice(O.length)]:n)}),i=i.join(R),t&&(t=o(t),t&&(r="?"+t)),m+i+r}var s=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},c=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),h=void 0,f=void 0,l=void 0,p=void 0,v=void 0,d=void 0,E=void 0,m="#!",O=":",R="/",g="&",y="=",_="[]",T=function(){function n(){s(this,n),this.list=[]}return c(n,[{key:"use",value:function(n,e){f.func(n)&&this.list.push({fn:n,context:e})}},{key:"run",value:function(n,e,t,o){var i=this.list,r=-1,a=function a(u){null==u?(r++,i[r]?i[r].fn.call(i[r].context,n,e,a):t&&t()):o&&o(u)};a()}}]),n}(),H=function(){function n(e){s(this,n);var t=this;t.name2Path={},t.path2Route={},t.handleHashChange=t.onHashChange.bind(t);var o=v,i=o.each,r=o.has,a=n.ROUTE_DEFAULT,u=n.ROUTE_404;return r(e,a)?r(e,u)?void i(e,function(n,e){r(n,"name")&&(t.name2Path[n.name]=e),t.path2Route[e]=n}):void console.error('Route for 404["'+u+'"] is required.'):void console.error('Route for default["'+a+'"] is required.')}return c(n,[{key:"go",value:function(n){if(f.string(n))location.hash=u(n);else if(f.object(n))if(v.has(n,"component"))this.setComponent(n);else if(v.has(n,"name")){var e=this.name2Path[n.name];if(!f.string(e))return void console.error("Name["+n.name+"] of the route is not found.");location.hash=u(e,n.params,n.query)}}},{key:"onHashChange",value:function(){var e=this,t=e.path2Route,o=location,i=o.hash;i=d.startsWith(i,m)?i.slice(m.length):"";var r=a(t,i);v.has(r,"path")||(r.path=i?n.ROUTE_404:n.ROUTE_DEFAULT),this.setComponent(r)}},{key:"setComponent",value:function(e){var t=this,o=t.path2Route,i=t.currentRoute,r=t.currentComponent;r||(r={});var a=r,s=a.options,c=a.instance,l=e.path,p=(e.realpath,e.params),d=e.query,m=e.component,O=e.props,R=void 0;m||(R=o[l],m=R.component);var g=function(n){n===!1?i&&i.path&&(location.hash=u(i.path,i.params,i.query)):t.go(n)},y=function(n,o,r){var a=new T;a.use(s&&s[n],c),a.use(R&&R[n],R),a.use(t&&t[n],t),a.run(e,i,o,r)},_=function(o){s=o,y(n.HOOK_BEFORE_ENTER,function(){(p||d)&&(O=v.extend({},p,d)),O&&f.object(o.propTypes)&&(O=E.validate(O,o.propTypes)),t.currentRoute=e,t.currentComponent={options:s,instance:c},c=new E(v.extend({el:t.el,props:O,extensions:{$router:t}},o)),y(n.HOOK_AFTER_ENTER)},g)},H=function(e){y(n.HOOK_BEFORE_LEAVE,function(){c.destroy(),c=null,y(n.HOOK_AFTER_LEAVE),_(e)},g)};r.name=m,h.component(m,function(o){m===r.name&&(c?s===o?y(n.HOOK_REROUTE,function(){H(o)},function(){t.currentRoute=e}):H(o):_(o))})}},{key:"start",value:function(n){this.el=f.string(n)?l.find(n):n,l.on(window,"hashchange",this.handleHashChange),this.handleHashChange()}},{key:"stop",value:function(){this.el=null,l.off(window,"hashchange",this.handleHashChange)}}]),n}();return H.version="0.16.0",H.ROUTE_DEFAULT="",H.ROUTE_404="*",H.HOOK_REROUTE="reroute",H.HOOK_BEFORE_ENTER="beforeEnter",H.HOOK_AFTER_ENTER="afterEnter",H.HOOK_BEFORE_LEAVE="beforeLeave",H.HOOK_AFTER_LEAVE="afterLeave",H.register=function(n,e){h.component(n,e)},H.install=function(n){h=new n({}),E=n,f=n.is,l=n.dom,p=n.array,v=n.object,d=n.string},"undefined"!=typeof Yox&&Yox.use&&Yox.use(H),H});
