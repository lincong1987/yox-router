!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.YoxRouter=t()}(this,function(){"use strict";function n(n){var t={};return f.string(n)&&l.each(n.split(_),function(n){var e=n.split("="),o=s(e,2),i=o[0],r=o[1];i&&(r=f.string(r)?decodeURIComponent(r):h.TRUE,i.endsWith("[]")?(t[i]||(t[i]=[])).push(r):t[i]=r)}),t}function t(n){var t=[];return p.each(n,function(n,e){f.array(n)?l.each(n,function(n){t.push(e+"[]="+encodeURIComponent(n))}):t.push(e+"="+encodeURIComponent(n))}),t.join(_)}function e(n,t){var e={},o=n.split(O),i=t.split(O);return o.length===i.length&&l.each(i,function(n,t){n.startsWith(E)&&(e[n.slice(E.length)]=o[t])}),e}function o(n,t){var e=void 0,o=t.split(O);return p.each(n,function(n,t){var i=t.split(O);if(o.length===i.length&&(l.each(i,function(n,e){if(!n.startsWith(E)&&n!==o[e])return t=null,!1}),t))return e=t,!1}),e}function i(t,i){var r=void 0,u=void 0,a=i.indexOf("?");a>=0?(r=i.substring(0,a),u=i.slice(a+1)):r=i;var c=o(t,r);if(c)return{path:c,realpath:r,params:e(r,c),query:n(u)}}function r(n,e,o){var i=[],r="";return l.each(n.split(O),function(n){i.push(n.startsWith(E)?e[n.slice(E.length)]:n)}),i=i.join(O),o&&(o=t(o),o&&(r="?"+o)),y+i+r}function u(n,t){var e=f,o=e.func,i=e.object,r=w[n];o(r)?!function(){var e=r.$pending;e||(e=r.$pending=[],r(function(t){l.each(e,function(n){n(t)}),w[n]=t})),e.push(t)}():i(r)&&t(r)}var a=(function(){function n(n){this.value=n}function t(t){function e(n,t){return new Promise(function(e,i){var a={key:n,arg:t,resolve:e,reject:i,next:null};u?u=u.next=a:(r=u=a,o(n,t))})}function o(e,r){try{var u=t[e](r),a=u.value;a instanceof n?Promise.resolve(a.value).then(function(n){o("next",n)},function(n){o("throw",n)}):i(u.done?"return":"normal",u.value)}catch(n){i("throw",n)}}function i(n,t){switch(n){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}r=r.next,r?o(r.key,r.arg):u=null}var r,u;this._invoke=e,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(n){return this._invoke("next",n)},t.prototype.throw=function(n){return this._invoke("throw",n)},t.prototype.return=function(n){return this._invoke("return",n)},{wrap:function(n){return function(){return new t(n.apply(this,arguments))}},await:function(t){return new n(t)}}}(),function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}),c=function(){function n(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),s=function(){function n(n,t){var e=[],o=!0,i=!1,r=void 0;try{for(var u,a=n[Symbol.iterator]();!(o=(u=a.next()).done)&&(e.push(u.value),!t||e.length!==t);o=!0);}catch(n){i=!0,r=n}finally{try{!o&&a.return&&a.return()}finally{if(i)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=void 0,h=void 0,l=void 0,p=void 0,v=void 0,m=void 0,d=void 0,y="#!",E=":",O="/",_="&",g="hashchange",R=function(){function n(){a(this,n),this.funcs=[]}return c(n,[{key:"use",value:function(n){f.func(n)&&this.funcs.push(n)}},{key:"run",value:function(n,t,e,o,i){var r=this.funcs,u=-1,a=function a(c){c==h.NULL?(u++,r[u]?r[u].call(n,t,e,a):o&&o()):i&&i(c)};a()}}]),n}(),b=function(){function n(){a(this,n),this.name2Path={},this.path2Route={},this.emitter=new m}return c(n,[{key:"on",value:function(n,t){this.emitter.on(n,t)}},{key:"once",value:function(n,t){this.emitter.once(n,t)}},{key:"off",value:function(n,t){this.emitter.off(n,t)}},{key:"fire",value:function(n,t){this.emitter.fire(n,t)}},{key:"map",value:function(n){var t=this.name2Path,e=this.path2Route,o=p,i=o.each,r=o.has;i(n,function(n,o){r(n,"name")&&(t[n.name]=o),e[o]=n})}},{key:"go",value:function(n){f.string(n)?location.hash=r(n):f.object(n)&&(p.has(n,"component")?this.setComponent(n.component,n.props):location.hash=r(this.name2Path[n.name],n.params,n.query))}},{key:"handleHashChange",value:function(){var t=this.path2Route,e=location,o=e.hash;o=o.startsWith(y)?o.slice(y.length):"";var r=i(t,o);if(r){var u=r.path,a=r.params,c=r.query,s=t[u].component;this.setComponent(s,p.extend({},a,c),u)}else this.fire(o?n.HOOK_NOT_FOUND:n.HOOK_INDEX)}},{key:"setComponent",value:function(t,e,o){f.object(e)||(e={});var i=this,r=i.path2Route,a=i.componentConfig,c=i.componentInstance,s={component:i.component,props:i.props,path:i.path},l={component:t,props:e,path:o},v=function(n,t){var e=new R;e.use(a&&a[n]),e.use(o&&r[o]&&r[o][n]),e.use(i&&i[n]),e.run(c,s,l,t)},m=function(t){a=t,v(n.HOOK_BEFORE_ENTER,function(){c=new d(p.extend({el:i.el,props:e,extensions:{$router:i}},t)),v(n.HOOK_AFTER_ENTER),p.extend(i,l),i.componentConfig=a,i.componentInstance=c})},y=function(t){v(n.HOOK_BEFORE_LEAVE,function(){c.dispose(),c=h.NULL,v(n.HOOK_AFTER_LEAVE),m(t)})};i.componentName=t,u(t,function(e){t===i.componentName&&(c?a===e?(v(n.HOOK_REFRESH,function(){y(e)}),p.extend(i,l)):y(e):m(e))})}},{key:"start",value:function(n){this.el=n,this.handleHashChange(),v.on(h.win,g,this.handleHashChange,this)}},{key:"stop",value:function(){this.el=h.NULL,v.off(h.win,g,this.handleHashChange)}}]),n}(),w={};return b.HOOK_INDEX="index",b.HOOK_NOT_FOUND="404",b.HOOK_REFRESH="refresh",b.HOOK_BEFORE_ENTER="beforeEnter",b.HOOK_AFTER_ENTER="afterEnter",b.HOOK_BEFORE_LEAVE="beforeLeave",b.HOOK_AFTER_LEAVE="afterLeave",b.register=function(n,t){f.object(n)?p.extend(w,n):w[n]=t},b.install=function(n){d=n;var t=d,e=t.utils;f=e.is,h=e.env,l=e.array,p=e.object,v=e.native,m=e.Emitter},"undefined"!=typeof Yox&&Yox.use&&Yox.use(b),b});
